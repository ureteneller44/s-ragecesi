<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Hayati ƒ∞≈üler ‚Ä¢ Y√∂netim Paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top, #020617 0, #020617 50%, #000 100%);
      color: #e5e7eb; min-height: 100vh;
      display: flex; align-items: center; justify-content: center;
      padding: 20px 12px;
    }
    .app {
      width: 100%; max-width: 1100px;
      background: radial-gradient(circle at top, rgba(15,23,42,0.96), rgba(15,23,42,0.98));
      border-radius: 22px; border: 1px solid rgba(148, 163, 184, 0.5);
      overflow: hidden;
    }
    .app-header {
      padding: 16px 20px 10px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }
    .tabs-bar { padding: 10px 18px 0; display: flex; gap: 8px; flex-wrap: wrap; }
    .tab-btn {
      border-radius: 999px; border: 1px solid rgba(148,163,184,0.6);
      padding: 7px 14px; cursor: pointer;
      background: rgba(15,23,42,0.95); color: #e5e7eb;
    }
    .tab-btn.active {
      background: linear-gradient(90deg, #f97316, #ea580c);
      color: #0f172a; border-color: white;
    }
    .tab-section { display: none; }
    .tab-section.active { display: block; }

    .form-card {
      margin-top: 4px; padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }
    .form-group { margin-bottom: 8px; }
    .form-input, .form-textarea {
      width: 100%; padding: 7px 9px;
      border-radius: 10px; background: rgba(15,23,42,0.98);
      border: 1px solid rgba(148, 163, 184, 0.8);
      color: white;
    }
    .btn {
      padding: 8px 16px; border-radius: 999px;
      background: linear-gradient(90deg, #f97316, #ea580c);
      border: none; cursor: pointer;
      color: #0f172a; font-weight: bold;
    }

    .preview-bar {
      background: rgba(60,0,0,0.6);
      padding: 14px; border-radius: 14px; margin-top: 12px;
    }

    /* Yorum Listesi */
    .comment-box {
      background: #0f172a; padding: 12px; border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.4); margin-bottom: 12px;
    }
    .comment-actions button {
      margin-right: 8px; margin-top: 6px;
    }
  </style>
</head>

<body>
<div class="app">

  <header class="app-header">
    <div>
      <h1>Hayati ƒ∞≈üler ‚Ä¢ Y√∂netim Paneli</h1>
      <small>Buradan duyuru, galeri ve yorumlarƒ± y√∂netin.</small>
    </div>

    <button onclick="window.location.href='index.html'" style="background:none;color:white;text-decoration:underline;cursor:pointer;">
      √áƒ±kƒ±≈ü yap
    </button>
  </header>

  <!-- SEKME BUTONLARI -->
  <div class="tabs-bar">
    <button class="tab-btn active" data-target="tab-announcement">üì¢ Duyuru</button>
    <button class="tab-btn" data-target="tab-photos">üì∏ Resimler</button>
    <button class="tab-btn" data-target="tab-videos">üé• Videolar</button>
    <button class="tab-btn" data-target="tab-comments">üí¨ Yorumlar</button>
  </div>

  <div class="content">

    <!-- DUYURU -->
    <section id="tab-announcement" class="tab-section active">
      <div class="form-card">

        <label>≈ûehir</label>
        <input id="cityInput" class="form-input">

        <label>Mekan</label>
        <input id="venueInput" class="form-input">

        <label>Saat</label>
        <input id="timeInput" class="form-input">

        <label>G√ºn bilgisi</label>
        <input id="dayTextInput" class="form-input">

        <label>Alt a√ßƒ±klama</label>
        <textarea id="subTextInput" class="form-textarea"></textarea>

        <button id="saveBtn" class="btn">Kaydet</button>

        <div class="preview-bar">
          <strong>√ñnizleme:</strong>
          <div id="previewMain"></div>
          <div id="previewSub"></div>
        </div>

      </div>
    </section>

    <!-- RESƒ∞M GALERƒ∞Sƒ∞ -->
    <section id="tab-photos" class="tab-section">
      <div class="form-card">
        <h3>Fotoƒüraf Y√ºkle</h3>

        <label>Dosya se√ß</label>
        <input type="file" id="photoFile" class="form-input" accept="image/*">

        <label>Ba≈ülƒ±k</label>
        <input type="text" id="photoTitle" class="form-input">

        <label>A√ßƒ±klama</label>
        <textarea id="photoDesc" class="form-textarea"></textarea>

        <button id="uploadPhotoBtn" class="btn">Y√ºkle</button>
      </div>

      <h3 style="margin-top:18px;">Y√ºklenmi≈ü Fotoƒüraflar</h3>
      <div id="photosList"></div>
    </section>

    <!-- Vƒ∞DEO GALERƒ∞Sƒ∞ -->
    <section id="tab-videos" class="tab-section">
      <div class="form-card">
        <h3>Video Y√ºkle</h3>

        <label>Dosya se√ß</label>
        <input type="file" id="videoFile" class="form-input" accept="video/*">

        <label>Ba≈ülƒ±k</label>
        <input type="text" id="videoTitle" class="form-input">

        <label>A√ßƒ±klama</label>
        <textarea id="videoDesc" class="form-textarea"></textarea>

        <button id="uploadVideoBtn" class="btn">Y√ºkle</button>
      </div>

      <h3 style="margin-top:18px;">Y√ºklenmi≈ü Videolar</h3>
      <div id="videosList"></div>
    </section>

    <!-- YORUMLAR SEKME -->
    <section id="tab-comments" class="tab-section">
      <h3>Bekleyen Yorumlar</h3>
      <div id="commentsList"></div>
    </section>

  </div><!-- content END -->

</div><!-- app END -->


<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="../firebase-init.js"></script>

<script>
/* ---------------------------------------------------
   SEKME GE√áƒ∞≈ûƒ∞
--------------------------------------------------- */
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tab-section").forEach(s => s.classList.remove("active"));

    btn.classList.add("active");
    document.getElementById(btn.dataset.target).classList.add("active");
  });
});

/* ---------------------------------------------------
   DUYURU - FIRESTORE
--------------------------------------------------- */
const ANN_ID = "QEYYxEpClLZ5yKZVLxeS";

async function loadAnnouncement() {
  const snap = await db.collection("announcements").doc(ANN_ID).get();
  const data = snap.data() || {};

  document.getElementById("cityInput").value = data.city || "";
  document.getElementById("venueInput").value = data.venue || "";
  document.getElementById("timeInput").value = data.time || "";
  document.getElementById("dayTextInput").value = data.day || "";
  document.getElementById("subTextInput").value = data.sub || "";

  updatePreview();
}

function updatePreview() {
  document.getElementById("previewMain").innerHTML =
    `${cityInput.value} ‚Ä¢ ${venueInput.value} ‚Ä¢ ${timeInput.value}`;

  document.getElementById("previewSub").innerText =
    subTextInput.value;
}

document.getElementById("saveBtn").onclick = async () => {
  await db.collection("announcements").doc(ANN_ID).set({
    city: cityInput.value,
    venue: venueInput.value,
    time: timeInput.value,
    day: dayTextInput.value,
    sub: subTextInput.value,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  }, { merge: true });

  alert("Duyuru kaydedildi!");
};

["cityInput","venueInput","timeInput","dayTextInput","subTextInput"].forEach(id => {
  document.getElementById(id).addEventListener("input", updatePreview);
});


/* ---------------------------------------------------
   CLOUDINARY AYAR
--------------------------------------------------- */
const CLOUD = "dqwpwghbx";
const PRESET = "unsigned_upload";

async function cloudUpload(file, type="image") {
  const url = `https://api.cloudinary.com/v1_1/${CLOUD}/${type}/upload`;
  const fd = new FormData();
  fd.append("file", file);
  fd.append("upload_preset", PRESET);

  const res = await fetch(url,{ method:"POST", body:fd });
  const data = await res.json();
  return data.secure_url;
}


/* ---------------------------------------------------
   FOTOƒûRAF Y√úKLEME
--------------------------------------------------- */
document.getElementById("uploadPhotoBtn").onclick = async () => {
  const file = document.getElementById("photoFile").files[0];
  if (!file) return alert("Fotoƒüraf se√ß!");

  const url = await cloudUpload(file, "image");

  await db.collection("photos").add({
    url,
    title: photoTitle.value.trim(),
    desc: photoDesc.value.trim(),
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  loadPhotos();
  alert("Fotoƒüraf y√ºklendi!");
};


/* ---------------------------------------------------
   FOTOƒûRAF Lƒ∞STELEME ‚Äî √úSTTE Sƒ∞L BUTONU ƒ∞LE
--------------------------------------------------- */
async function loadPhotos() {
  const el = document.getElementById("photosList");
  el.innerHTML = "Y√ºkleniyor...";

  const snap = await db.collection("photos")
    .orderBy("createdAt", "desc").get();

  let html = "";
  snap.forEach(doc => {
    const p = doc.data();

    html += `
<div class="comment-box" style="margin-bottom:20px; padding:12px; border-radius:14px; position:relative;">

  <!-- FOTOƒûRAF + √úSTTE Sƒ∞L BUTONU -->
  <div style="position:relative; margin-bottom:10px;">
    <img src="${p.url}" style="width:100%; border-radius:12px;">

    <button
      onclick="deletePhoto('${doc.id}')"
      style="
        position:absolute;
        top:10px;
        right:10px;
        background:#ef4444;
        color:white;
        padding:6px 12px;
        font-size:14px;
        border-radius:8px;
        border:none;
        cursor:pointer;
      ">
      Sil
    </button>
  </div>

  <!-- BA≈ûLIK VE A√áIKLAMA -->
  ${p.title ? `<strong style="font-size:15px;">${p.title}</strong><br>` : ""}
  ${p.desc ? `<span style="font-size:14px; opacity:0.8;">${p.desc}</span><br>` : ""}
</div>
    `;
  });

  el.innerHTML = html;
}


/* ---------------------------------------------------
   FOTOƒûRAF Sƒ∞LME
--------------------------------------------------- */
async function deletePhoto(id) {
  const ok = confirm("Bu fotoƒürafƒ± silmek istiyor musun?");
  if (!ok) return;

  await db.collection("photos").doc(id).delete();
  loadPhotos();
}

/* ---------------------------------------------------
   Vƒ∞DEO Y√úKLEME
--------------------------------------------------- */
document.getElementById("uploadVideoBtn").onclick = async () => {
  const file = document.getElementById("videoFile").files[0];
  if (!file) return alert("Video se√ß!");

  const url = await cloudUpload(file, "video");

  await db.collection("videos").add({
    url,
    title: videoTitle.value.trim(),
    desc: videoDesc.value.trim(),
    createdAt: firebase.firestore.FieldValue.serverTimestamp()
  });

  loadVideos();
  alert("Video y√ºklendi!");
};


/* ---------------------------------------------------
   Vƒ∞DEO Lƒ∞STELEME ‚Äî √úSTTE Sƒ∞L BUTONU ƒ∞LE
--------------------------------------------------- */
async function loadVideos() {
  const el = document.getElementById("videosList");
  el.innerHTML = "Y√ºkleniyor...";

  const snap = await db.collection("videos")
    .orderBy("createdAt", "desc").get();

  let html = "";
  snap.forEach(doc => {
    const v = doc.data();

    html += `
<div class="comment-box" style="margin-bottom:20px; padding:12px; border-radius:14px; position:relative;">

  <!-- Vƒ∞DEO + √úSTTE Sƒ∞L BUTONU -->
  <div style="position:relative; margin-bottom:10px;">
    <video controls style="width:100%; border-radius:12px;">
      <source src="${v.url}">
    </video>

    <button
      onclick="deleteVideo('${doc.id}')"
      style="
        position:absolute;
        top:10px;
        right:10px;
        background:#ef4444;
        color:white;
        padding:6px 12px;
        font-size:14px;
        border-radius:8px;
        border:none;
        cursor:pointer;
      ">
      Sil
    </button>
  </div>

  <!-- BA≈ûLIK VE A√áIKLAMA -->
  ${v.title ? `<strong style="font-size:15px;">${v.title}</strong><br>` : ""}
  ${v.desc ? `<span style="font-size:14px; opacity:0.8;">${v.desc}</span><br>` : ""}
</div>
    `;
  });

  el.innerHTML = html;
}


/* ---------------------------------------------------
   Vƒ∞DEO Sƒ∞LME
--------------------------------------------------- */
async function deleteVideo(id) {
  const ok = confirm("Bu videoyu silmek istiyor musun?");
  if (!ok) return;

  await db.collection("videos").doc(id).delete();
  loadVideos();
}

/* ---------------------------------------------------
   YORUM Lƒ∞STELE ‚Äî ONAY / Sƒ∞L
--------------------------------------------------- */
async function loadComments() {
  const el = document.getElementById("commentsList");
  el.innerHTML = "Y√ºkleniyor...";

  const snap = await db.collection("comments")
    .where("approved","==",false)
    .orderBy("createdAt","desc").get();

  let html = "";
  snap.forEach(doc => {
    const c = doc.data();

    html += `
<div class="comment-box">
  <strong>${c.name}</strong> (${c.rating}‚≠ê)<br>
  <small>${c.venue}</small><br><br>
  ${c.text}<br>

  <div class="comment-actions">
    <button class="btn" onclick="approveComment('${doc.id}')">Onayla</button>
    <button class="btn" onclick="deleteComment('${doc.id}')">Sil</button>
  </div>
</div>`;
  });

  el.innerHTML = html;
}

async function approveComment(id) {
  await db.collection("comments").doc(id).set({
    approved: true
  },{ merge:true });

  loadComments();
}

async function deleteComment(id) {
  await db.collection("comments").doc(id).delete();
  loadComments();
}


/* ---------------------------------------------------
   SAYFA A√áILINCA T√úM VERƒ∞LERƒ∞ Y√úKLE
--------------------------------------------------- */
loadAnnouncement();
loadPhotos();
loadVideos();
loadComments();
</script>

</body>
</html>
